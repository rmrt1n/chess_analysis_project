---
title: "wrangle scraped data"
output: html_notebook
---

### load libraries
```{r message = FALSE}
library(readr)
library(dplyr)
library(tidyr)
```

### import & view data
```{r message = FALSE, warning = FALSE}
df <- read_csv("scraped_data.csv")
head(df)
```

### Tidy data
```{r}
df <- df %>%
  rename(White = "Player 1", Black = "Player 2") %>%
  separate(White, into = c("White", "White_rating"), sep = "  .*?(?=\\()") %>%
  separate(Black, into = c("Black", "Black_rating"), sep = "  .*?(?=\\()") %>%
  mutate(
    Color = if_else(str_detect(White, "Hikaru") == TRUE, "White", "Black")
  ) %>%
  mutate(
    Rating = if_else(Color == "White", White_rating, Black_rating)
  ) %>%
  mutate(
    Opponent = if_else(str_detect(White, "Hikaru") == TRUE, Black, White)
  ) %>%
  mutate(
    Opponent_rating = if_else(Color == "White", Black_rating, White_rating)
  ) %>%
  mutate(
    Result = if_else(Color == "White" & Result == "1-0", "Win",
               if_else(Color == "White" & Result == "0-1", "Loss",
                 if_else(Color == "Black" & Result == "1-0", "Loss",
                   if_else(Color == "Black" & Result == "0-1", "Win", "Draw")
                 )
               )
             )
  ) %>%
  select(Color, Rating, Opponent, Opponent_rating, Result, Moves, Year) %>%
  mutate(Rating = str_extract(Rating, "(?<=\\().*?(?=\\))")) %>%
  mutate(Opponent_rating = str_extract(Opponent_rating, "(?<=\\().*?(?=\\))")) %>%
  mutate_at(c("Color", "Result"), as.factor) %>%
  mutate_at(c("Rating", "Opponent_rating"), as.numeric)

head(df)
```
#### New column descriptions:
- Color =  Hikaru's piece color
- Rating =  His rating at the time
- Opponent = His opponent
- Opponent_rating = His opponent's rating
- Result = The result of the match:
    * Win = Hikaru won the game
    * Loss = Hikaru loss the game
    * Draw = The game ends in a draw
- Moves = The ammount of moves played
- Year = The year the game is played

### write to csv
```{r}
write_csv(df, "cleaned_data.csv")
```
